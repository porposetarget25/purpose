<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Travel & Safety | World Explorer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preload" href="assets/css/styles.css" as="style" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#0a3d62">
    <style>
        /* Small page-specific polish */
        .ts-hero { position: relative; overflow: hidden; border-radius: 20px; margin: 20px auto; }
        .ts-hero .hero__media { filter: brightness(0.85) saturate(110%); }
        .ts-wrap { max-width: 1100px; margin: 0 auto; padding: 16px; }
        .ts-controls { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; margin: 12px 0 20px; }
        .ts-select { appearance:none; padding:12px 16px; border-radius:14px; border:1px solid #e6e9f0; background:#fff; font-weight:600 }
        .ts-card { background: rgba(255,255,255,0.9); backdrop-filter: blur(6px);
                   border: 1px solid #eef1f6; border-radius: 16px; padding: 18px; margin: 12px 0; }
        .ts-card h3 { margin: 0 0 8px; font-size: 1.05rem; }
        .ts-muted { color:#6b7280; font-size: .9rem; }
        .ts-badge { display:inline-block; padding:6px 10px; border-radius:999px; background:#eef5ff; color:#1d4ed8; font-weight:600; font-size:.8rem; }
        .ts-note { background:#fff8d8; border:1px solid #f2e7a8; color:#6b5f02; padding:10px 12px; border-radius:12px; font-size:.9rem; }
        @media (max-width: 860px) { .ts-wrap { padding: 12px; } }
    </style>
</head>

<body>
<!-- Topbar -->
<nav class="topbar">
    <div class="topbar__inner container">
        <a class="brand" href="index.html" aria-label="World Explorer Home">
            <span class="brand__logo globe">üåê</span>
            <span class="brand__text">
        <strong>World Explorer</strong>
        <small>Explore the World's Wonders</small>
      </span>
        </a>
        <ul class="nav">
            <li><a class="nav__link" href="index.html">Home</a></li>
            <li><a class="nav__link is-active" href="travel.html">Travel &amp; Safety</a></li>
        </ul>
    </div>
</nav>

<!-- Hero -->
<header class="hero ts-hero"
        style="--hero-photo: url('https://images.unsplash.com/photo-1534854638093-bada1813ca19?q=80&w=1600&auto=format&fit=crop')">
    <div class="hero__media" aria-hidden="true"></div>
    <div class="hero__overlay"></div>
    <div class="hero__content container">
        <h1 class="hero__title">Travel &amp; Safety</h1>
        <p class="hero__tagline">Quick essentials for a safer, smoother trip. Policies change often‚Äîalways verify with official sources.</p>
    </div>
</header>

<main class="ts-wrap">
    <!-- Controls -->
    <div class="ts-controls">
        <span class="ts-badge">Select a country</span>
        <select id="country-select" class="ts-select" aria-label="Select a country">
            <!-- Filled by JS -->
        </select>
        <span class="ts-muted">Tip: information here is a helpful summary, not legal advice. Double-check before you travel.</span>
    </div>

    <!-- Output cards -->
    <section id="ts-output">
        <!-- Filled by JS -->
    </section>
</main>

<!-- keep your existing markup; replace the <script> content with this: -->
<script>
    const selectEl = document.getElementById('country-select');
    const out = document.getElementById('ts-output');

    // Countries to offer in the dropdown (start small, you can add all later)
    const COUNTRIES = ["Turkey","India","USA","UAE","New Zealand","United Kingdom","Japan","Singapore","France","Italy","Spain","Australia","Canada"];

    function countryOptionTpl(name) { return `<option value="${name}">${name}</option>`; }

    function sectionTpl(title, items) {
      const list = (items || []).map(i => `<li>${i}</li>`).join("");
      return `<article class="ts-card"><h3>${title}</h3><ul>${list}</ul></article>`;
    }

    function renderLoading(name) {
      out.innerHTML = `
        <article class="ts-card">
          Loading travel & safety info for <strong>${name}</strong>‚Ä¶
        </article>`;
    }

    function renderError(name, msg) {
      out.innerHTML = `
        <article class="ts-card ts-note">
          Couldn‚Äôt load info for <strong>${name}</strong>. ${msg || "Please try again."}
        </article>`;
    }

    function renderCountryData(d) {
      out.innerHTML = `
        <div class="ts-muted" style="margin:6px 0">${d.country} ‚Ä¢ Updated: ${d.updated_at}</div>
        ${sectionTpl("1) Visa & Entry Requirements", d.visa)}
        ${sectionTpl("2) Local Laws & Rules", d.laws)}
        ${sectionTpl("3) Safety & Security", d.safety)}
        ${sectionTpl("4) Emergency Numbers", d.emergency)}
        ${sectionTpl("5) Health Precautions", d.health)}
        <article class="ts-card ts-note">${d.disclaimer}</article>
      `;
    }

    // 24h local cache
    const TTL_MS = 24 * 60 * 60 * 1000;
    function cacheKey(country) { return `ts:${country.toLowerCase()}`; }

    function getCached(country) {
      try {
        const raw = localStorage.getItem(cacheKey(country));
        if (!raw) return null;
        const obj = JSON.parse(raw);
        if (Date.now() - obj.saved > TTL_MS) return null;
        return obj.data;
      } catch { return null; }
    }

    function setCached(country, data) {
      try {
        localStorage.setItem(cacheKey(country), JSON.stringify({ saved: Date.now(), data }));
      } catch {}
    }

    async function fetchCountry(country) {
      const cached = getCached(country);
      if (cached) return cached;

      const resp = await fetch(`/api/travel-safety?country=${encodeURIComponent(country)}`);
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const json = await resp.json();
      setCached(country, json);
      return json;
    }

    async function showCountry(country) {
      renderLoading(country);
      try {
        const data = await fetchCountry(country);
        renderCountryData(data);
      } catch (e) {
        console.error(e);
        renderError(country, "Check your connection or try again later.");
      }
    }

    // Init
    selectEl.innerHTML = COUNTRIES.map(countryOptionTpl).join("");
    showCountry(COUNTRIES[0]);

    selectEl.addEventListener('change', () => showCountry(selectEl.value));
</script>

</body>
</html>
